<%- include('../partials/header.ejs') %>
      <div class="card">

<% if ( order !== 'undefined' && order) { %>
  <h2>Order Details</h2>

  <p><strong>Order ID:</strong> <%= order._id %></p>
  <p><strong>Order Date:</strong> <%= new Date(order.orderDate).toLocaleString('en-GB', { dateStyle: 'full', timeStyle: 'short' }) %></p>
  <p><strong>Total Price:</strong> $<%= order.totalPrice %></p>
  <p><strong>Delivery Address:</strong> <%= order.deliveryAddress %></p>
  <p><strong>Status:</strong> <%= order.status || 'Pending' %></p>

  <hr>

  <h3>User Info</h3>
  <p><strong>Name:</strong> <%= order.user.first %> <%= order.user.last %></p>
  <p><strong>Email:</strong> <%= order.user.email %></p>

  <hr>

  <h3>Ordered Books</h3>
  <ul>
    <% if (order.cart.length > 0) { %>
      <% order.cart.forEach(book => { %>
        <li>
          <strong>Title:</strong> <%= book.title %> |
          <strong>Author:</strong> <%= book.author?.name || book.author.name %> |
          <strong>Price:</strong> $<%= book.unitPrice || book.price %>
        </li>
      <% }) %>
    <% } else { %>
      <li>No books found in this order.</li>
    <% } %>
  </ul>

<% } else if ( books !== 'undefined' && books.length > 0) { %>

  <h1>Your Cart</h1>

  <ul>
    <% books.forEach(book => { %>
      <li><%= book.title %> - $<%= book.unitPrice || book.price %> (Qty: <%= book.qty || 1 %>)</li>
    <% }) %>
  </ul>

  <p><strong>Total: $<%= total || books.reduce((sum, b) => sum + (b.unitPrice || b.price || 0) * (b.qty || 1), 0).toFixed(2) %></strong></p>

  <form action="/order" method="POST">
    <% books.forEach(book => { %>
      <input type="hidden" name="cart[]" value="<%= book.id || book._id %>" />
    <% }) %>

    <label for="address">Delivery Address:</label>
    <input type="text" name="deliveryAddress" required />

    <button type="submit">Place Order</button>
  </form>

<% } else { %>
  <p>Your cart is empty.</p>
<% } %>
      </div>
<%- include('../partials/footer.ejs') %>
